<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    
    <link rel="shortcut icon" href="../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Czujniki - IoTAzurePi</title>
    <link href="../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../js/jquery-3.2.1.min.js"></script>
    <script src="../js/bootstrap-3.3.7.min.js"></script>
    <script src="../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Dokumentacja techniczna cz\u0119\u015bci sprz\u0119towej", url: "#_top", children: [
              {title: "Czujnik temperatury i wilgotno\u015bci DHT11", url: "#czujnik-temperatury-i-wilgotnosci-dht11" },
              {title: "Czujnik nat\u0119\u017cenia \u015bwiat\u0142a", url: "#czujnik-natezenia-swiata" },
              {title: "Czujnik wilgotno\u015bci gleby", url: "#czujnik-wilgotnosci-gleby" },
              {title: "Pompa do wody", url: "#pompa-do-wody" },
          ]},
        ];

    </script>
    <script src="../js/base.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../ioT_hub/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../ioT_hub/" class="btn btn-xs btn-link">
        IoT Hub
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../cosmoDB/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../cosmoDB/" class="btn btn-xs btn-link">
        CosmoDB
      </a>
    </div>
    
  </div>

    

    <h1 id="dokumentacja-techniczna-czesci-sprzetowej">Dokumentacja techniczna części sprzętowej</h1>
<p>Do zrealizowania części sprzętowej skorzystano z modułów komunikacyjnych wbudowanych w platformę mikroprocesorową Raspberry Pi. Rozpisane piny urządzenia znajdują się na rysunku poniżej:</p>
<hr />
<h2 id="czujnik-temperatury-i-wilgotnosci-dht11"><a href="#czujnik-temperatury-i-wilgotności-dht11">Czujnik temperatury i wilgotności DHT11</a></h2>
<p><img src="../media/GPIO-Pinout-Diagram-2.png" alt="drawing" width="600" height="600"/></p>
<p>Do pomiaru temperatury i wilgotności użyto czujnik wilgotności DHT11. Jest to czujnik cyfrowy z interfejsem jednoprzewodowym. Zakres jego pracy dla temperatury to od -20 °C do +60 °C, a wilgotności od 5 % do 95 % RH. Czujnik ma rozdzielczość 8-bitową, przez co jego dokładność to 1°C oraz ±1 % RH.</p>
<p><img src="../media/dht11.png" alt="drawing" width="400" height="400"/></p>
<p>Czujnik podłączony został do napięcia 3.3 V urządzenia Raspberry Pi (pin 1), uziemienie do pinu 9 oraz dane zostały podłączone do GPIO 17 dostępnego na pinie 11.
W celu poprawnej komunikacji jednoprzewodowej konieczne jest zastosowanie rezystora pomiędzy napięciem a linią danych. Rezystor powinien mieć wartość o 4.7k do 10k Ohm. Połączenie czujnika z RPi zostało przedstawione na poniższym rysunku:</p>
<p><img src="../media/DHT11_pi.png" alt="drawing" width="400" height="400"/></p>
<p>Do połączenia się z czujnikiem wykorzystano gotową bibliotekę od Adafruit. W celu instalacji tej biblioteki trzeba wykonać następujące kroki:
Zainstalować potrzebne narzędzia:</p>
<pre><code>    sudo apt-get update
    sudo apt-get install build-essential python-dev
</code></pre>
<p>Następnie pobrać bibliotekę z repozytorium na githubie:
git clone https://github.com/adafruit/Adafruit_Python_DHT.git
cd Adafruit_Python_DHT
Następnie zainstalować bibliotekę dla Pythona 2 i Pythona 3 za pomocą komend:</p>
<pre><code>    sudo python setup.py install
    sudo python3 setup.py install
</code></pre>
<p>Do komunikacji z czujnikiem został napisany skrypt w języku Python. Przykładowy kod programu umożliwiający komunikację z czujnikiem:</p>
<pre><code>    import sys

    import Adafruit_DHT

    # 11 stand for DHT-11 and 17 stands for GPIO pin
    humidity, temperature = Adafruit_DHT.read_retry(11, 17)

    if humidity is not None and temperature is not None:
    print('Temp={0:0.1f}*  Humidity={1:0.1f}%'.format(temperature, humidity))
    else:
    print('Failed to get reading. Try again!')
    sys.exit(1)
</code></pre>
<hr />
<h2 id="czujnik-natezenia-swiata"><a href="#czujnik-natężenia-światła">Czujnik natężenia światła</a></h2>
<p>Zastosowanym czujnikiem światła jest BH1750. Jest to czujnik przetwarzający natężenie światła o długości z zakresu od 320 nm do 1050 nm na mierzalną (np. poprzez zastosowanie mikrokontrolera) proporcjonalną częstotliwość. Zakres działania czujnika to 1-65535 lx (luksów) z rozdzielczością 1 lub 4 lx w zależności od wybranego trybu pracy. Komunikuje się poprzez interfejs I2C (TWI), czyli dwie linie: danych - SDA i zegarową SCL.</p>
<p><img src="../media/Czujnik_natenia_wiata_GY-30_-_BH1750_1.jpg" alt="drawing" width="400" height="400"/></p>
<p>Czujnik podłączony został do napięcia 3.3 V z urządzenia Raspberry Pi, uziemienie do GND oraz dane zostały podłączone do GPIO 2 (SDA) oraz do GPIO 3 (SCL) został podłączony zegar interfejsu I2C.</p>
<p><img src="../media/BH1750-Module-Setup.png" alt="drawing" width="400" height="400"/></p>
<p>Do komunikacji z czujnikiem wykorzystano magistralę I2C. Po podłączeniu pinu ADD do uziemienie urządzenie ma adres 0x23. Można ustawić różne tryby odczytu. Wykorzystany został tryb 0x20, jest to tryb umożliwiający odczyt z dokładnością do 1 lx oraz pozwalający na wyłączenie urządzenia po odczycie w celu oszczędzenia energii. Przykładowy kod w języku Python:</p>
<pre><code>    def convert_GY30_to_Number(data):
    # Simple function to convert 2 bytes of data
    # into a decimal number.
    result=(data[1] + (256 * data[0])) / 1.2
    return (result)

    def read_data_GY30():
    bus = smbus.SMBus(1)  # Rev 2 Pi uses 1
    # 0x23 is an addres of device, 0x20 is measurement at 1lx resolution.
    # Time typically 120ms
    # Device is automatically set to Power Down after measurement.
    data = bus.read_i2c_block_data(0x23,0x20)
    return convert_GY30_to_Number(data)
</code></pre>
<hr />
<h2 id="czujnik-wilgotnosci-gleby"><a href="#czujnik-wilgotności-gleby">Czujnik wilgotności gleby</a></h2>
<p>Zasilany jest napięciem od 3,3 V do 5 V.  Urządzenie składa się z trzech części: sondy pomiarowej, modułu detektora oraz przewodów. Sondy należy połączyć z modułem głównym przy pomocy przewodów i umieścić w glebie, której wilgotność będzie mierzona.</p>
<p>Czujnik posiada wyjście cyfrowe D0 sygnalizujące przekroczenie ustawionej za pomocą potencjometru wartości oraz analogowe A0 przy pomocy którego uzyskuje się dokładną wartość wilgotności. Za pomocą potencjometru ustawiany jest próg, po którego przekroczeniu wyjście D0 przechodzi ze stanu wysokiego w stan niski. Czujnik posiada także wyjście analogowe A0, które należy podłączyć do wyprowadzenia przetwornika A/C, a następnie możliwe jest za pomocą interfejsu I2C połączenie z urządzeniem Raspberry Pi. </p>
<p><img src="../media/gleba.png" alt="drawing" width="400" height="400"/></p>
<hr />
<h2 id="pompa-do-wody"><a href="#pompa-do-wody">Pompa do wody</a></h2>
<p>Do podlewania rośliny w doniczce została wykorzystana pompka do wody działająca na bazie komutatorowego silnika prądu stałego. Pompa zasilana jest napięciem od 2.5 - 6 V. Prąd pobierany przez silnik wynosi 130-220 mA. Wydajność przepływu cieczy to 80-120 L/h. 
Maksymalny prąd, który może być pobierany z zasilania 5V urządzenia Raspberry Pi to 300 mA, więc z urządzenia bez problemu można zasilić pompę do wody. Do wysterowania silnikiem został użyty mostek H L293D. </p>
<p><img src="../media/pompka.png" alt="drawing" width="400" height="400"/></p>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../ioT_hub/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../ioT_hub/" class="btn btn-xs btn-link">
        IoT Hub
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../cosmoDB/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../cosmoDB/" class="btn btn-xs btn-link">
        CosmoDB
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="container-fluid wm-page-content">
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>